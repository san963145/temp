<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>


<c:if test="${empty sessionScope.user}">
     <jsp:forward page="index.jsp"/>   
</c:if>
<%
   String data=(String)request.getAttribute("data");

%>
<!DOCTYPE html>
<html>


  <head>
    <base href="${sessionScope.basePath }">

    <meta charset="UTF-8">
    <title>Stock Analysis System</title>
	
    <meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	
  
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	
    <link rel="stylesheet" href="dist/css/my.css">
    <!-- Bootstrap 3.3.4 æ¡æ¶-->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
	
	<link rel="stylesheet" href="bootstrap/css/bootstrap-datetimepicker.min.css">
	
	<link rel="stylesheet" href="bootstrap/css/daterangepicker-bs3.css">
    <!-- FontAwesome 4.3.0 å¾æ -->
    <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
    <!-- Theme style ç½ç«æé -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css"> 
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
    
    <link rel="stylesheet" href="plugins/datatables/dataTables.bootstrap.css">
    
    <link rel="stylesheet" href="plugins/select2/select2.min.css">


    <link rel="stylesheet" href="pages/css/input.css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script charset="UTF-8">  

	function check()
	{
		var stock=document.getElementById("stock").value;
		var dateStart=document.getElementById("dateStart").value;
		var dateEnd=document.getElementById("dateEnd").value;
		if(stock=="")
	    {
			alert("Please input the stock!");
			return false;
	    }
		else if(dateStart=="")
		{
			alert("Please select the start date!");
			return false;
		}
		else if(dateEnd=="")
		{
			alert("Please select the end date!");
			return false;
		}
		else if(dateEnd<dateStart)
		{
			alert("End date can't be earlier than start date!");
			return false;
		}
		else
		{
			return true;
		}
	}		
  </script>
  </head>
  <body class="skin-green-light sidebar-mini" onload="init()">
    <div class="wrapper">

      <header class=" main-header" id="my-menu">
        <!-- Logo -->
		<a class="logo" href="#systems" data-toggle="collapse" data-parent="#my-menu">
			<b>Stock Analysis System&nbsp;&nbsp;<img src="img/arrow.gif" height="10" width="10" /></b>
		</a>
        <!-- Header Navbar: style can be found in header.less -->
        <nav class="navbar navbar-static-top" role="navigation">
          <!-- Sidebar toggle button-->
          <a href="#" class="sidebar-toggle visible-xs" data-toggle="offcanvas" role="button">
            <span class="sr-only">${sessionScope.user.username}</span>
          </a>
          <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
			  
              <!-- User info -->
              <li>
			    <a href="#" data-toggle="tooltip" data-placement="bottom" title="user information">${sessionScope.user.username}</a>
			  </li>
			  <li>
			    <a href="logout" data-toggle="tooltip" data-placement="bottom" title="logout"><i class="fa fa-mail-forward"></i></a>
			  </li>
        
            </ul>
          </div>
        </nav>
      </header>
      <!-- Left side column. contains the logo and sidebar -->
      <aside class="main-sidebar">
        <div id="systems" class="collapse in">
			<div class="box-div bg-green">
			  <a href="pages/main.jsp">
				<!-- small box -->
				  <div class="small-box bg-green">
					<div class="box-div">
					  <h3>Analyse</h3>
					  <p class="font">Daily Data</p>
					</div>
					<div class="icon">
					  <i class="glyphicon glyphicon-signal"></i>
					</div>
					<a href="pages/main.jsp" class="small-box-footer">Exit&nbsp;<i class="fa fa-arrow-circle-left"></i></a>
				  </div>
			  </a>
			</div>											
		</div>
		
		
      </aside>

      <!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<section class="content-header">
				<h1>
					<small class="font">Analysis</small>
				</h1>
				<ol class="breadcrumb">
					<li><a href="index.jsp"><i class="fa fa-dashboard"></i>
							MainPage</a></li>
					<li class="active">DailyData</li>
				</ol>
			</section>

			<!-- Main content -->
			<section class="content">
				<!-- Main row -->
				<div class="row">

					<!-- SELECT2 EXAMPLE -->
					<div class="box box-default">
						<div class="box-header with-border">
							<h3 class="box-title">Daily Data Statistics</h3>
							<div class="box-tools pull-right">
								<button class="btn btn-box-tool" data-widget="collapse">
									<i class="fa fa-minus"></i>
								</button>
							</div>
						</div>
						<!-- /.box-header -->
						<div class="box-body">
							<form action=day/search method="post"
								onsubmit="return check()">
								<div class="row">
									<div class="col-md-3">
										<div class="form-group">
											<label>Symbol</label> 
											
											
                                                <c:if test="${not empty stock}">
                                                    <input class="form-control" name="stock" style="width: 100%;" value="${stock}" id="stockContent" oninput="send(this.value)">
				                                    
		                                        </c:if>
		                                        <c:if test="${empty stock}">
				                                    <input class="form-control" name="stock" style="width: 100%;" value="" id="stockContent" oninput="send(this.value)">
		                                        </c:if>
 
											<div class="bdsug" id="inblock"
												style="height: auto; display: none;">
												<ul id="ulContent">
													
												</ul>
											</div>






										</div>
										<!-- /.form-group -->
									</div>
									<!-- /.col -->


									<div class="col-md-3">
										<div class="form-group">
											<label>Date</label>
											<div style="height: 100%;" class="input-append date"
												id="datetimepicker1">
												 
												<c:if test="${not empty dateStart}">
				                                    <input class="form-control" id="dateStart" name="dateStart"
													type="text" value="${dateStart}" placeholder="yyyy-mm-dd">
		                                        </c:if>
		                                        <c:if test="${empty dateStart}">
				                                    <input class="form-control" id="dateStart" name="dateStart"
													type="text" value="" placeholder="yyyy-mm-dd">
		                                        </c:if>
		                                        	
													<span class="add-on"><i
													class="icon-th"></i></span>
											</div>
										</div>
									</div>
									
									<div class="col-md-3">
										<div class="form-group">
											<label>Date</label>
											<div style="height: 100%;" class="input-append date"
												id="datetimepicker2">
												 
												<c:if test="${not empty dateEnd}">
				                                    <input class="form-control" id="dateEnd" name="dateEnd"
													type="text" value="${dateEnd}" placeholder="yyyy-mm-dd">
		                                        </c:if>
		                                        <c:if test="${empty dateEnd}">
				                                    <input class="form-control" id="dateEnd" name="dateEnd"
													type="text" value="" placeholder="yyyy-mm-dd">
		                                        </c:if>
		                                        	
													<span class="add-on"><i
													class="icon-th"></i></span>
											</div>
										</div>
									</div>
									

									<div class="col-md-2 col-md-offset-1">
										<label>&nbsp;</label>
										<button type="submit"
											class="btn btn-success btn-block btn-flat">Search</button>
									</div>
									<!-- /.col -->
								</div>
								<!-- /.row -->
							</form>
						</div>
						<!-- /.box-body -->
					</div>
					<!-- /.box -->

                  <c:if test="${not empty result}">
						<c:if test="${result=='isEmpty'}">
				            <div class="box box-info">
				              <div class="box-header with-border">
				                 <h3 class="box-title">Result Searched</h3>
				                 <div class="box-tools pull-right">
								<button class="btn btn-box-tool" data-widget="collapse">
									<i class="fa fa-minus"></i>
								</button>
							</div>
				             </div><!-- /.box-header -->				
					                 <p>No Matching Result!</p>
			               </div><!-- /.box -->
		               </c:if>
		               <c:if test="${result=='notEmpty'}">
			               <div class="box box-info">
			               
				<div class="box-header with-border">
				  <h3 class="box-title">Result Searched</h3>
				</div><!-- /.box-header -->

				<div class="box-body" id="map" style="width:1680px;height:550px;">
					
					
					
				</div><!-- /.box-body -->
					
			  </div><!-- /.box -->
		             </c:if>
		             
		          </c:if>
		          
		          
	</div><!-- /.row (main row) -->
        </section><!-- /.content -->
      </div><!-- /.content-wrapper -->
      <footer class="main-footer">
        <div class="pull-right hidden-xs">
          <b>Version</b> 1.0
        </div>
		<p class="text-center">
        <strong>Stock Analysis System</strong>
		</p>
      </footer>
    </div><!-- ./wrapper -->

    <!-- jQuery 2.1.4 -->
    <script src="plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="plugins/jQueryUI/jquery-ui.min.js"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
      $.widget.bridge('uibutton', $.ui.button);
    </script>
    <!-- Bootstrap 3.3.4 -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
	
	<script src="bootstrap/js/bootstrap-datetimepicker.min.js"></script>
	
	<script src="bootstrap/js/moment.js"></script>
 <!-- Select2 -->
    <script src="plugins/select2/select2.full.min.js"></script>
 
    <script src="plugins/fastclick/fastclick.min.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/app.min.js"></script>
    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->

    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js"></script>
    
    <script src="pages/js/input.js"></script>
	
	<!-- DataTables -->
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables/dataTables.bootstrap.min.js"></script>
    
    <script src="dist/js/echarts.min.js"></script>
    
	<script type="text/javascript">   
$('#datetimepicker1').datetimepicker({

        pickTime: false,
        todayBtn: true,
        autoclose: true,
        minView: '2',
        forceParse: false,
        format:"yyyy-mm-dd"
    });
$('#datetimepicker2').datetimepicker({

    pickTime: false,
    todayBtn: true,
    autoclose: true,
    minView: '2',
    forceParse: false,
    format:"yyyy-mm-dd"
});

    </script>
    
    <c:if test="${not empty data}">
		  
    
    <script type="text/javascript">

         var myChart = echarts.init(document.getElementById('map'));

var rawData = <%=data%>;
function calculateMA(dayCount, data) {
    var result = [];
    for (var i = 0, len = data.length; i < len; i++) {
        if (i < dayCount) {
            result.push('-');
            continue;
        }
        var sum = 0;
        for (var j = 0; j < dayCount; j++) {
            sum += data[i - j][1];
        }
        result.push(sum / dayCount);
    }
    return result;
}


var dates = rawData.map(function (item) {
    return item[0];
});

var data = rawData.map(function (item) {
    return [+item[1], +item[2], +item[3], +item[4]];
});

var volume = rawData.map(function (item) {
    return item[5];
});
var option = {
    backgroundColor: '#eee',
	animation: false,
    legend: {
            bottom: 10,
            left: 'center',
            data: ['stock', 'MA5', 'MA10', 'MA20', 'MA30']
    },
	
	toolbox: {
            feature: {
                dataZoom: {
                    yAxisIndex: false
                },
                brush: {
                    type: ['lineX', 'clear']
                }
            }
    },
	
    tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'line'
            }
    },
	
	brush: {
            xAxisIndex: 'all',
            brushLink: 'all',
            outOfBrush: {
                colorAlpha: 0.1
            }
    },
	
	grid: [
            {
                left: '10%',
                right: '8%',
                height: '50%'
            },
            {
                left: '10%',
                right: '8%',
                top: '63%',
                height: '16%'
            }
        ],
		
    xAxis: [{
        type: 'category',
        data: dates,
        scale: true,
                boundaryGap : false,
                axisLine: {onZero: false},
                splitLine: {show: false},
                splitNumber: 20,
                min: 'dataMin',
                max: 'dataMax'
    },
	{
	    type: 'category',
		gridIndex: 1,
        data: dates,
		scale: true,
                boundaryGap : false,
                axisLine: {onZero: false},
                axisTick: {show: false},
                splitLine: {show: false},
                axisLabel: {show: false},
                splitNumber: 20,
                min: 'dataMin',
                max: 'dataMax'
	}
	],
    yAxis: [
            {
                scale: true,
                splitArea: {
                    show: true
                }
            },
            {
                scale: true,
                gridIndex: 1,
                splitNumber: 2,
                axisLabel: {show: false},
                axisLine: {show: false},
                axisTick: {show: false},
                splitLine: {show: false}
            }
        ],

    dataZoom: [
            {
                type: 'inside',
                xAxisIndex: [0, 1],
                start: 98,
                end: 100
            },
            {
                show: true,
                xAxisIndex: [0, 1],
                type: 'slider',
                top: '85%',
                start: 98,
                end: 100
            }
        ],
		
    series: [
        {
            name: 'stock',
            type: 'candlestick',
            data: data,
            itemStyle: {
                normal: {
                    borderColor: null,
                    borderColor0: null
                }
            }
			
        },
        {
            name: 'MA5',
            type: 'line',
            data: calculateMA(5, data),
            smooth: true,
            showSymbol: false,
            lineStyle: {
                normal: {opacity: 0.5}
            }
        },
        {
            name: 'MA10',
            type: 'line',
            data: calculateMA(10, data),
            smooth: true,
            showSymbol: false,
            lineStyle: {
                normal: {opacity: 0.5}
            }
        },
        {
            name: 'MA20',
            type: 'line',
            data: calculateMA(20, data),
            smooth: true,
            showSymbol: false,
            lineStyle: {
                normal: {opacity: 0.5}
            }
        },
        {
            name: 'MA30',
            type: 'line',
            data: calculateMA(30, data),
            smooth: true,
            showSymbol: false,
            lineStyle: {
                normal: {opacity: 0.5}
            }
        },
		
		    {
                name: 'Volumn',
                type: 'bar',
                xAxisIndex: 1,
                yAxisIndex: 1,
                data: volume
            }
    ]
};
        myChart.setOption(option);
    </script>
	 </c:if>
    
  </body>
</html>
